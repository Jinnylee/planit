app.controller('AccommodationsCtrl', ['$scope', '$http', '$auth', '$location','$routeParams', function($scope, $http, $auth, $location, $routeParams){
  $scope.message = "Accommodations";

  $scope.accommodations = [];
  $scope.users = [];
  $scope.newAccommodation = {};
  $scope.nameList = [];
  $scope.tripId = $routeParams.trip_id;
  $scope.accommodationId = $routeParams.id;

  var checkPath = function() {
    if ($location.path() == '/trips/' + $routeParams.trip_id + '/accommodations/' + $routeParams.id + '/edit') {
      $scope.editing = true;
      $http({
        method: 'GET',
        url: 'http://localhost:3000/trips/' + $routeParams.trip_id + '/accommodations/' + $routeParams.id + '.json'
      }).then(function(resp){
        console.log("got single accommodation data!", resp);
        $scope.newAccommodation = resp.data
      }, function(resp){
        console.log("error");
        console.log(resp);
      });
      // $scope.newaccommodation = {
      //   title: accommodation.title,
      //   amount: accommodation.amount,
      //   user_id: accommodation.user_id,
      //   status: accommodation.status,
      //   id: accommodation.id
      // };
    } else {
      $scope.editing = false;
    }
  };
  checkPath();

  $scope.editPage = function(id) {
    $scope.accommodationId = id;
  }

  $scope.toggleName = function (name) {
    var nameIndex = $scope.nameList.indexOf(name);
    if (nameIndex == -1){
      $scope.nameList.push(name);
    } else {
      $scope.nameList.splice(nameIndex, 1)
    }
    console.log($scope.nameList);
  };

  var getAccommodations = function() {
    $http({
      method: 'GET',
      url: 'http://localhost:3000/trips/' + $routeParams.trip_id + '/accommodations.json'
    }).then(function(resp){
      console.log("showing accommodations!", resp);
      $scope.accommodations = resp.data
    }, function(resp){
      console.log("error");
      console.log(resp);
    });
  };


  var getUsers = function() {
    $http({
      method: 'GET',
      url: 'http://localhost:3000/trips/' + $routeParams.trip_id + '/users.json'
    }).then(function(resp){
      console.log("showing users info", resp)
      $scope.users = resp.data
    }, function(resp){
      console.log("error");
      console.log(resp)
    });
  };

  $scope.addAccommodation = function() {
    $scope.newAccommodation.name_list = $scope.nameList;

    $http({
      method:'POST',
      url: 'http://localhost:3000/trips/' + $routeParams.trip_id + '/accommodations',
      data: {
        accommodation: $scope.newAccommodation
      }
    }).then(function(resp){
      console.log("added new accommodation", resp);
      // getAccommodation();
      $scope.newAccommodation = {};
    }, function(resp){
      console.log("error");
      console.log(resp);
    });
  };

  $scope.deleteAccommodation = function(id, index) {
    $http({
      method: 'DELETE',
      url: 'http://localhost:3000/trips/' + $routeParams.trip_id + '/accommodations/' + id + '.json'
    }).then(function(resp){
      console.log("deleted accommodation", index)
      $scope.accommodations.splice(index, 1);
    }, function(resp){
      console.log("error");
      console.log(resp);
    });
  };

  getUsers();
  getAccommodations();

}]);