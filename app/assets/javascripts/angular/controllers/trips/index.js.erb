app.controller('TripsCtrl', ['$scope', '$http', function($scope, $http){

  $scope.logout = function () {
    $auth.signOut().then(function(resp) {
      console.log(resp);
    }).catch(function(resp) {
      console.log(resp);
    });
  };

  $scope.message = "Trips";
  $scope.trips = [];
  $scope.newOrEditTrip = {};
  $scope.editing = false;
  $scope.adding = true;

  var getTrips = function() {
    $http({
      method: 'GET',
      url: 'http://localhost:3000/trips.json'
   }).then(function(resp){
    console.log("showing trips!");
    console.log(resp);
    $scope.trips = resp.data
   }, function(resp){
    console.log("error");
    console.log(resp);
   });
  };

  $scope.toggleEditMode = function(trip) {
    console.log("togleEditMode", trip);
    $scope.newOrEditTrip = {
      location: trip.location,
      start_date: trip.start_date,
      end_date: trip.end_date,
      _id: trip.id
    };
    $scope.editing = true;
  };

  $scope.addOrEditTrip = function() {
    if ($scope.editing){
      console.log("EDITING FUNCTION");
      console.log("addOrEditTrip", $scope.newOrEditTrip);
      $http({
        method: 'PATCH',
        url: 'http://localhost:3000/trips/' + $scope.newOrEditTrip._id + '.json',
        data: $scope.newOrEditTrip
      }).then(function(resp){
        console.log("edited trip");
        getTrips();
        $scope.newOrEditTrip = {};
        $scope.editing = false;
      }, function(resp){
        console.log("error");
        console.log(resp);
      });
    } else {
      console.log("POST FUNCTION");
      $http({
        method:'POST',
        url: 'http://localhost:3000/trips.json',
        data: $scope.newOrEditTrip
      }).then(function(resp){
        console.log("added new trip")
        getTrips();
        $scope.newOrEditTrip = {};
      }, function(resp){
        console.log("error");
        console.log(resp);
      });
    }
  };

  $scope.deleteTrip = function(id) {
    $http({
      method: 'DELETE',
      url: 'http://localhost:3000/trips/' + id + '.json'
    }).then(function(resp){
      console.log("deleted trip")
      getTrips();
    }, function(resp){
      console.log("error");
      console.log(resp);
    });
  };

  getTrips();

}]);